<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <meta charset="UTF-8">
        <title>Document</title>
        <style>
            *{
                margin:0;
                padding:0;
                box-sizing:border-box;
            }
            body{
                padding:2rem;
            }
            main{
                display: grid;
                gap:1rem;
                grid-template-columns: 100px 100px 100px 100px;
                grid-template-rows: 100px 100px 100px 100px;
            }
            div{
                border:2px solid black;
                
            }
            
            .carta.disactive{
                background-color: black;
            }
            .carta.pink{
                background-color: pink;
            }
            .carta.yellow{
                background-color: yellow;
            }
            .carta.green{
                background-color: green;
            }
            .carta.red{
                background-color: red;
            }
            .carta.violet{
                background-color: violet;
            }
            .carta.brown{
                background-color: brown;
            }
            .carta.blue{
                background-color: blue;
            }
            .carta.orange{
                background-color: orange;
            }
            



        </style>
    </head>
    <body>
        <h1></h1>
        <main></main>
        



        <script>
            let totTurni =0;
            const COLORI = ['pink','red','blue','orange','green','violet','brown','yellow','pink','red','blue','orange','green','violet','brown','yellow'];
            class Carta{
                constructor(id,color){
                    this.id=id;
                    this.color=color;
                    // Salva il riferimento alla funzione handler
                    this.handleClick = () => {
                        scopriCarta(this);
                    };
                }
                get getColor(){
                    return this.color;
                }
                get getId(){
                    return this.id;
                }   
            }
            let listaCarte = [];
            start();

            function updateTurni(){
                
                
                const myH1 = document.getElementsByTagName('h1')[0];
                myH1.textContent = `Turni: ${totTurni}`;
                
                totTurni++;
            }

            function start(){
                fillBody();
                updateTurni();
            }

            function fillBody(){
                COLORI.sort(() => Math.random()-0.5);
                for(let i=0;i<16;i++){
                    
                    const cardDiv = document.createElement('div');
                    cardDiv.className = `carta disactive`;
                    cardDiv.id=i;
                    const myCarta = new Carta(i,COLORI[i]);
                    listaCarte.push(myCarta);

                    cardDiv.addEventListener('click',myCarta.handleClick);
                    
                    
                    const myBody = document.getElementsByTagName('main')[0];
                    myBody.appendChild(cardDiv);    
                }
            }

            let carteSelezionate=[];
            
            function scopriCarta(myCarta){

                
                carteSelezionate.push(myCarta);
                    
                const divCarta = document.getElementById(myCarta.getId);
                divCarta.className = `carta ${myCarta.getColor}`;
                    
                if(carteSelezionate.length==2){
                    controlloCoppia();
                    updateTurni();
                }
                
            }

            function controlloCoppia(){
                const carta0 = document.getElementById(carteSelezionate[0].getId);
                const carta1 = document.getElementById(carteSelezionate[1].getId);
                if(carteSelezionate[0].getColor != carteSelezionate[1].getColor){
                    setTimeout(function (){
                        carta0.className = `carta disactive`;
                        carta1.className = `carta disactive`;
                    },1000)
                }else{
                    carta0.removeEventListener('click',carteSelezionate[0].handleClick);
                    carta1.removeEventListener('click',carteSelezionate[1].handleClick);
                                      
                }
                carteSelezionate=[];
            }
        </script>
    </body>
</html>